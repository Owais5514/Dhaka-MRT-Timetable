name: Update Index "What's New" Section

on:
  push:
    branches: [main]  # adjust branch as needed

jobs:
  update-index-whatsnew:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Generate commit log and update index.html
        run: |
          COMMIT_LOG=$(git log -n 10 --pretty=format:"<li>%h - %s</li>")
          awk -v commitList="<ul>$COMMIT_LOG</ul>" '
            /<!-- COMMIT_LOG_START -->/ {
              print
              print commitList
              inBlock=1
              next
            }
            /<!-- COMMIT_LOG_END -->/ {
              inBlock=0
            }
            !inBlock { print }
          ' docs/index.html > docs/index.new && mv docs/index.new docs/index.html

      - name: Commit updated index.html
        run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          git add docs/index.html
          git commit -m "Update What's New section in index.html with latest commits" || echo "No changes to commit"
          git push
